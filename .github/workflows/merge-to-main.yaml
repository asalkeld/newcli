---
name: Merge to main
on:
  schedule:
    - cron: '0 8 * * 1'
  workflow_dispatch:

jobs:
  update-dep:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        ref: main
      - name: merge to main
        run: |
          git config user.name "nitric-bot"
          git config user.email "maintainers@nitric.io"
          git config pull.rebase false

          git merge --ff-only origin/develop
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: Release last weeks work
          title: Release last weeks work
          author: nitric-bot <maintainers@nitric.io>
          committer: nitric-bot <maintainers@nitric.io>
          token: ${{ secrets.NITRIC_BOT_TOKEN }}
          body: |
            - Weekly merge to main

            Auto-generated by https://github.com/nitrictech/cli/tree/develop/.github/workflows/merge-to-main.yaml

          branch: auto/merge-to-main
